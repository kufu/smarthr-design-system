#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 画像・アイコンまたはreadme.txtに変更がった場合はzipファイルを作り直し、コミットに含める
files_diff=`git diff --cached --name-only`
readme_file=`echo "$files_diff" | sed -n '/scripts\/downloads\/readme\.txt/p'`
img_files=`echo "$files_diff" | sed -n '/content\/articles\/basics\/illustration\/images\//p'`
icon_files=`echo "$files_diff" | sed -n '/content\/articles\/basics\/icons\/images\//p'`

if [ -n "$img_files" ] || [ -n "$icon_files" ] || [ -n "$readme_file" ]; then
  yarn export:zip-images
  git add 'static/downloads/*'
fi

# .mdxファイルに変更があった場合はOGP画像を作り直し、コミットに含める
mdx_files=`echo "$files_diff" | sed -n '/content\/articles\/.*\.mdx/p'`

if [ -n "$mdx_files" ]; then
  for line in $mdx_files
  do
    npx ts-node ./scripts/ogpImage/generateSingleOgImage.ts "./"$line""
  done
  git add 'static/images/*'
fi

yarn lint-staged
